version: '3.8'

services:
  # Module 2: Time-Series DB for "Graph Trends"
  # We use TimescaleDB (a PostgreSQL extension) for full SQL support [1, 2, 3]
  timescaledb:
    image: timescale/timescaledb-ha:pg14-latest
    container_name: trader_timescaledb
    environment:
      - POSTGRES_PASSWORD=your_secure_password
    ports:
      - "5432:5432"
    volumes:
      -./timescaledb_data:/var/lib/postgresql/data
    healthcheck:
      test:
      interval: 5s
      timeout: 5s
      retries: 5

  # The Main "All-in-One" Trading Bot Application
  trader_app:
    container_name: trader_app
    build:.
    command: python main.py
    restart: on-failure
    volumes:
      -.:/app
    environment:
      # Pass API keys from a.env file
      - KALSHI_API_KEY_ID=${KALSHI_API_KEY_ID}
      - KALSHI_PRIVATE_KEY_PATH=${KALSHI_PRIVATE_KEY_PATH}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - SERPER_API_KEY=${SERPER_API_KEY} # <-- CHANGED
    depends_on:
      timescaledb:
        condition: service_healthy